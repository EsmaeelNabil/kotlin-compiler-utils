#!/bin/bash

# Git pre-commit hook to automatically format code with Spotless
# This hook runs before each commit and auto-fixes formatting violations

set -e

echo "ğŸ¨ Running pre-commit formatting check..."

# Check if spotlessCheck passes
if ! ./gradlew spotlessCheck --quiet; then
    echo "ğŸ”§ Code formatting violations found, applying fixes..."
    
    # Apply formatting fixes
    ./gradlew spotlessApply --quiet
    
    # Check if there are changes to add to the commit
    if ! git diff --quiet; then
        echo "ğŸ“ Adding formatted files to commit..."
        git add -u  # Add only tracked files that were modified
        echo "âœ… Formatting fixes applied and staged"
    else
        echo "â„¹ï¸ No formatting changes were needed"
    fi
else
    echo "âœ… Code formatting is already correct"
fi

echo "ğŸš€ Pre-commit formatting check complete"